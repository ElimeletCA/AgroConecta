@using AgroConecta.Presentation.Client.Components.Seguridad
@using AgroConecta.Shared.Constantes.Seguridad
@implements IDisposable

@inject NavigationManager NavigationManager


<AuthorizeView>
    <Authorized>
        <!-- Menú principal -->
        <MudNavMenu>
            <!-- Sección de Dashboard General -->
            <MudNavLink Href="sistema/dashboard" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">Inicio</MudNavLink>
           
            <!-- Sección de Propietario -->
            <MudNavGroup Icon="@Icons.Material.Filled.Person" Title="Propietario" Expanded="false">
                <MudNavLink Href="sistema/dashboard/propietario" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.InsertChart">Dashboard</MudNavLink>
                <MudNavLink Href="sistema/terrenos" Icon="@Icons.Material.Filled.Terrain">Terrenos</MudNavLink>
                <MudNavLink Href="sistema/arrendamientos" Icon="@Icons.Material.Filled.RealEstateAgent">Arrendamientos</MudNavLink>
            </MudNavGroup>
            <!-- Sección de Agricultor -->
            <MudNavGroup Icon="@Icons.Material.Filled.Agriculture" Title="Agricultor" Expanded="false">
                <MudNavLink Href="sistema/dashboard/agricultor" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.InsertChart">Dashboard</MudNavLink>
                <MudNavLink Href="sistema/arrendamientos" Icon="@Icons.Material.Filled.RealEstateAgent">Arrendamientos</MudNavLink>
                <MudNavLink Href="sistema/proyectos" Icon="@Icons.Material.Filled.FolderCopy">Proyectos</MudNavLink>
            </MudNavGroup>
            <!-- Sección de Inversionista -->
            <MudNavGroup Icon="@Icons.Material.Filled.Savings" Title="Inversionista" Expanded="false">
                <MudNavLink Href="sistema/dashboard/inversionista" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.InsertChart">Dashboard</MudNavLink>
                <MudNavLink Href="sistema/proyectos" Icon="@Icons.Material.Filled.FolderCopy">Proyectos</MudNavLink>
            </MudNavGroup>
            @if (context.User.IsInRole(Roles.Administrador.ToString()))
            {
                <!-- Sección de Gestión de Tipos -->
                <MudNavGroup Icon="@Icons.Material.Filled.Category" Title="Gestión de Tipos" Expanded="false">
                    <MudNavLink Href="sistema/tiposmedidaarea" Icon="@Icons.Material.Filled.ViewQuilt">Tipos de Medidas de Área</MudNavLink>
                    <MudNavLink Href="sistema/tipossuelo" Icon="@Icons.Material.Filled.Grass">Tipos de Suelo</MudNavLink>
                    <MudNavLink Href="sistema/tiposcultivo" Icon="@Icons.Material.Filled.RiceBowl">Tipos de Cultivos</MudNavLink>
                    <MudNavLink Href="sistema/tiposarrendamiento" Icon="@Icons.Material.Filled.AccountBalance">Tipos de Arrendamientos</MudNavLink>
                </MudNavGroup>

                <!-- Sección de Configuracion -->
                <MudNavGroup Icon="@Icons.Material.Filled.Settings" Title="Configuración" Expanded="false">
                    <MudNavLink Href="sistema/seguridad/usuarios" Icon="@Icons.Material.Filled.ManageAccounts">Usuarios</MudNavLink>
                    <MudNavLink Href="sistema/seguridad/roles" Icon="@Icons.Material.Filled.Security">Roles</MudNavLink>
                    <MudNavLink Href="/sistema/seguridad/logs" Icon="@Icons.Material.Filled.History">Logs</MudNavLink>
                    <MudNavLink Href="sistema/configuracion/archivos" Icon="@Icons.Material.Filled.PermMedia">Archivos</MudNavLink>
                </MudNavGroup>

            }
        </MudNavMenu>
    </Authorized>
</AuthorizeView>


@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }

}