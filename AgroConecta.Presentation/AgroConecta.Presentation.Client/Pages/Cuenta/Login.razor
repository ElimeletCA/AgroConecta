@using AgroConecta.Presentation.Client.Layout
@using AgroConecta.Shared.Security
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject IJSRuntime JS
@inject HttpClient Http

@page "/Cuenta/Login"
@layout EmptyLayout



<PageTitle>Iniciar sesi√≥n - AgroConecta</PageTitle>


<br />
<MudText Typo="Typo.h6">Usuario</MudText>
<MudTextField @bind-Value="usuario.Email" Label="Correo electronico" Variant="Variant.Outlined"></MudTextField>
<MudText Typo="Typo.h6">Clave</MudText>
<MudTextField @bind-Value="usuario.pasword_without_hash" Label="Password" Variant="Variant.Outlined"></MudTextField>
<br />
<MudButton Variant="Variant.Filled" @onclick=IniciarSesion Color="Color.Primary">Ingresar</MudButton>
No esta registrado?<MudLink Href="/Cuenta/Registro">Crear una cuenta</MudLink>

@code {
    string token = null;


    UsuarioDTO usuario = new UsuarioDTO();
    
    async Task IniciarSesion()
    {
        var resultado = await Http.PostAsJsonAsync("api/Auth/Login", usuario);
        
        
        token = await resultado.Content.ReadAsStringAsync();
        await JS.InvokeVoidAsync("localStorage.setItem", "Token", token);
        await AuthenticationStateProvider.GetAuthenticationStateAsync();
    }
}