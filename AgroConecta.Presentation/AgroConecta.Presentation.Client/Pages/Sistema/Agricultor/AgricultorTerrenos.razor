@page "/sistema/agricultor/proyectos"
@using AgroConecta.Presentation.Client.Pages.Sistema.Propietario
@using AgroConecta.Shared.DTO
@inject ISnackbar Snackbar
@inject IDialogService DialogService
<MudContainer Class="py-4 py-sm-8 py-md-12 py-lg-16 py-xl-20">
    <MudItem xs="12">
        <MudImage ObjectFit="ObjectFit.Cover" Src="./images/dummy/dummy-proyecto-11.jpg" Alt="Örebro Slott" Class="rounded-lg" Height="256" Style="width: 100%" />
    </MudItem>
    <MudDivider Style="color: #ffffff; height: 20px;" />
    <MudItem xs="12">
        <MudGrid Class="mb-8">
            <MudItem xs="12" md="6">
                <MudText Typo="Typo.h2" Class="mud-typography-h4 mb-2">
                    Mis proyectos
                </MudText>
                <MudSkeleton Animation="Animation.False" SkeletonType="SkeletonType.Rectangle" Height="4px" Width="20%" Style="background-color: #ffffff;" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudButton Variant="Variant.Filled"
                           Class="flow-button mb-2 "
                           Color="Color.Primary"
                           StartIcon="@Icons.Material.Filled.Add"
                           >Agregar proyecto</MudButton>

                <MudText Typo="Typo.body1">
                    Estos son los diversos proyectos agrícolas que tienes publicados en la plataforma, diseñados para impulsar iniciativas agropecuarias y fomentar el desarrollo sostenible en el sector rural.                 </MudText>

            </MudItem>
        </MudGrid>
    </MudItem>
    <MudItem xs="12" Class="mb-6">
        <MudText Class="pb-1" HtmlTag="label" for="input_busqueda" Style="@($"color:{Colors.Shades.Black};")">Buscar proyectos</MudText>
        <MudTextField Margin="Margin.Dense"
                      Class="flow-input"
                      InputId="input_busqueda"
                      Label=""
                      Variant="Variant.Outlined"
                      @bind-Value="SearchTerm"
                      Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search"
                      Immediate="true"/>
    </MudItem>
    <MudGrid>
        <MudItem xs="12">
            <MudGrid Class="mb-8">
                <!-- Tu contenido del encabezado -->
            </MudGrid>
        </MudItem>

        @foreach (var card in CurrentPageCards)
        {
            <MudItem xs="12" sm="6" md="3">
                <MudCard>
                    <MudCardMedia Image="@card.Image" Height="160"/>
                    <MudCardContent Style="min-height: 250px;">
                        <div style="height: 48px; overflow: hidden;">
                            <MudText Typo="Typo.button" Class="mud-primary-text">@card.Subtitle</MudText>
                        </div>
                        <MudText Typo="Typo.h6" Class="mb-4">@card.Title</MudText>
                        <MudText Typo="Typo.body2">@card.Description</MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        }
    </MudGrid>

    <div class="d-flex justify-center my-6">
        <MudPagination @bind-Selected="CurrentPage"
                       Count="@TotalPages"
                       BoundaryCount="2"/>
    </div>
</MudContainer>

@code {
    private int CurrentPage = 1;
    private int ItemsPerPage = 8; // Ajusta según necesidad
    private bool _isLoadingData;

private List<CardItem> Cards = new List<CardItem>
{
    new CardItem("Proyecto Mango", "Azua de Compostela", "Proyecto agrícola de 50 hectáreas enfocado en la producción intensiva de mango, aprovechando el clima seco y suelos fértiles.", "./images/dummy/dummy-proyecto-1.jpg"),
    new CardItem("Proyecto Lechuga", "Constanza", "Iniciativa de 30 hectáreas para el cultivo de hortalizas y fresas, optimizada por un clima templado y técnicas innovadoras.", "./images/dummy/dummy-proyecto-2.jpg"),
    new CardItem("Proyecto Habichuela", "San Juan de la Maguana", "Desarrollo agrícola de 75 hectáreas orientado a la producción de habichuelas, con sistemas de riego modernos que aseguran altos rendimientos.", "./images/dummy/dummy-proyecto-3.jpg"),
    new CardItem("Proyecto Manzana", "Santiago de los Caballeros", "Finca de 40 hectáreas especializada en el cultivo de tabaco, aprovechando la tradición y la experiencia en zonas tabacaleras.", "./images/dummy/dummy-proyecto-4.jpg"),
    new CardItem("Proyecto Cacao Orgánico", "San Francisco de Macorís", "Proyecto de 60 hectáreas dedicado a la producción de cacao, en una región con alta pluviometría y prácticas ecológicas.", "./images/dummy/dummy-proyecto-5.jpg"),
    new CardItem("Proyecto Plátano", "Santa Cruz de Barahona", "Iniciativa de 80 hectáreas para el cultivo de plátanos, con acceso a fuentes de agua que garantizan una producción estable.", "./images/dummy/dummy-proyecto-6.jpg"),
    new CardItem("Proyecto Piña", "Monte Plata", "Desarrollo agrícola de 55 hectáreas centrado en la producción de piña, aprovechando suelos arenosos y condiciones climáticas favorables.", "./images/dummy/dummy-proyecto-7.jpg"),
    new CardItem("Proyecto Tomate", "Baní", "Proyecto de 45 hectáreas orientado al cultivo de tomate, implementando técnicas avanzadas para maximizar el rendimiento en clima semiárido.", "./images/dummy/dummy-proyecto-8.jpg"),
    new CardItem("Proyecto Azúcar", "Higüey", "Iniciativa integral de 70 hectáreas para la producción de caña de azúcar, respaldada por una larga tradición azucarera y prácticas modernas.", "./images/dummy/dummy-proyecto-9.jpg"),
    new CardItem("Proyecto Café", "San Felipe de Puerto Plata", "Proyecto agrícola de 35 hectáreas dedicado al cultivo de café de alta calidad, ubicado en zonas montañosas con excelente altitud.", "./images/dummy/dummy-proyecto-10.jpg")
};

    // Lista paginada (modificada para usar la lista filtrada)
    private List<CardItem> CurrentPageCards => FilteredCards
        .Skip((CurrentPage - 1) * ItemsPerPage)
        .Take(ItemsPerPage)
        .ToList();

    // Total de páginas basado en la lista filtrada
    private int TotalPages => (int)Math.Ceiling((double)FilteredCards.Count / ItemsPerPage);
    public class CardItem
    {
        public string Title { get; set; }
        public string Subtitle { get; set; }
        public string Description { get; set; }
        public string Image { get; set; }

        public CardItem(string title, string subtitle, string description, string image)
        {
            Title = title;
            Subtitle = subtitle;
            Description = description;
            Image = image;
        }
    }
    private string _searchTerm = string.Empty;
    private string SearchTerm
    {
        get => _searchTerm;
        set
        {
            _searchTerm = value;
            CurrentPage = 1; // Resetear a primera página al buscar
        }
    }

    // Lista filtrada
    private List<CardItem> FilteredCards => Cards
        .Where(c =>
            c.Title.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase) ||
            c.Subtitle.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase) ||
            c.Description.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase))
        .ToList();


    #region Obtener terrenos
    protected override async Task OnInitializedAsync()
    {
        await GetAll();
    }

    private async Task GetAll()
    {
        _isLoadingData = true;
        //listaTiposMedidaArea = await TipoMedidaAreaAgent.GetAllAsync();
        _isLoadingData = false;
        StateHasChanged();
    }
    

    #endregion
    
    #region Agregar terreno

    private async Task OpenCreateDialog()
    {
        var result = await DialogService.Show<FrmTerreno>("Nuevo terreno", new DialogOptions {
            CloseButton = true,
            BackdropClick = false
        }).Result;
    
        if (!result.Canceled) await GetAll();
    }    

    #endregion
}
