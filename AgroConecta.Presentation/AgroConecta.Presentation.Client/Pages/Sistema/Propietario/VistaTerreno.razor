@page "/sistema/vistaterreno/{terrenoId}"
@using System.Globalization
@using AgroConecta.Presentation.Client.Agents.Interfaces.Sistema
@using AgroConecta.Shared.DTO
@inject IJSRuntime JS

@inject ITerrenoAgent TerrenoAgent
<MudContainer Class="py-4 py-sm-8 py-md-12 py-lg-16 py-xl-20">
    <MudGrid>
        <MudItem xs="12">
            <MudImage ObjectFit="ObjectFit.Cover" Src="./images/dummy/dummy-terreno-1.jpg" Alt="Örebro Slott" Class="rounded-lg" Height="256" Style="width: 100%" />
        </MudItem>
        <MudItem xs="12" md="3" Class="d-flex flex-column align-center">
            <MudCard>
                <MudCardContent Style="min-height: 250px;">
                    <center>
                    <MudAvatar Class="mb-2" Color="Color.Default" Variant="Variant.Filled" Size="Size.Large">
                        <MudImage Src="./images/avatar/avatar-5.png"></MudImage>
                    </MudAvatar>
                    </center>
                    <MudText Typo="Typo.h5" Class="mb-2">@Terreno.NombrePropietario</MudText>
                    <MudSkeleton Animation="Animation.False" SkeletonType="SkeletonType.Rectangle" Height="4px" Width="20%" Class="mb-4" Style="background-color: #ffffff"/>
                    <MudText Align="Align.Center" Typo="Typo.body1">Cantidad de área</MudText>
                    <MudText Align="Align.Center" Typo="Typo.body2">@($" {Terreno.CantidadAreaSueloTotal} {Terreno.DescripcionTipoMedidaArea}")</MudText>
                    <MudText Align="Align.Center" Typo="Typo.body2">@($"Suelo {Terreno.DescripcionTipoSuelo}")</MudText>


                </MudCardContent>
            </MudCard>

        </MudItem>
        <MudItem xs="12" md="9">
            <MudText Typo="Typo.h6" HtmlTag="p">Provincia @Terreno.DescripcionProvincia</MudText>
            <MudText Typo="Typo.h6" HtmlTag="p">Municipio @Terreno.DescripcionMunicipio</MudText>

            <MudText Typo="Typo.body1" HtmlTag="p">@Terreno.Descripcion</MudText>
            @*
            <MudButton Class="mt-2" Variant="Variant.Text" Color="Color.Primary" EndIcon="@Icons.Material.Filled.ArrowForward">Learn More</MudButton>
            *@
            <br/>
            <div id="mapTerreno" class="map" style="height:250px;width:550px"></div>

        </MudItem>
    </MudGrid>
</MudContainer>
@code {
    [Parameter] 
    public string terrenoId { get; set; }
    private TerrenoDTO Terreno { get; set; } = new TerrenoDTO();

    protected async override void OnInitialized()
    {
        if (!string.IsNullOrEmpty(terrenoId))
        {
            Terreno = await TerrenoAgent.GetByIdAsync(terrenoId, new[]
            {
                "Municipio", "Municipio.Provincia",
                "TipoMedidaArea",
                "TipoSuelo",
                "Propietario"
                
                
            }) ;
        }
        await JS.InvokeVoidAsync("GenerarMapa",
            Terreno.CoordenadaLatitud.ToString(CultureInfo.InvariantCulture), 
            Terreno.CoordenadaLongitud.ToString(CultureInfo.InvariantCulture),
            "8",
            Terreno.DescripcionProvincia
        );

        StateHasChanged();


    }
}