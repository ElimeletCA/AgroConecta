@page "/sistema/dashboard"
@using System.Security.Claims
@using AgroConecta.Presentation.Client.Components.Seguridad
@using AgroConecta.Presentation.Client.Helpers.Seguridad
@using AgroConecta.Shared.Constantes.Seguridad
@using Microsoft.AspNetCore.Authorization
@inject HttpClient Http
@inject IJSRuntime JS
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider
<PageTitle>Dashboard - AgroConecta</PageTitle>
<AuthorizeView>
  <Authorized>


    <MudText Typo="Typo.h5" Color="Color.Primary" Class="mb-4">Dashboard</MudText>
    <MudGrid>
      <!--Primera fila-->

      <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="d-flex flex-row pt-6 pb-4" Style="height:100px;">
          <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Color="Color.Primary" Class="mx-4" Style="width:40px; height:40px;"></MudIcon>
          <div>
            <MudText Typo="Typo.subtitle1" Class="mud-text-secondary mb-n1">Costo total</MudText>
            <MudText Typo="Typo.h6">RD$153,000.00</MudText>
          </div>
        </MudPaper>
      </MudItem>
      <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="d-flex flex-row pt-6 pb-4" Style="height:100px;">
          <MudIcon Icon="@Icons.Material.Filled.Layers" Color="Color.Secondary" Class="mx-4" Style="width:40px; height:40px;"></MudIcon>
          <div>
            <MudText Typo="Typo.subtitle1" Class="mud-text-secondary mb-n1">Total de activos</MudText>
            <MudText Typo="Typo.h6">RD$21,000.00</MudText>
          </div>
        </MudPaper>
      </MudItem>
      <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="d-flex flex-row pt-6 pb-4" Style="height:100px;">
          <MudIcon Icon="@Icons.Material.Filled.TrendingUp" Color="Color.Success" Class="mx-4" Style="width:40px; height:40px;"></MudIcon>
          <div>
            <MudText Typo="Typo.subtitle1" Class="mud-text-secondary mb-n1">Porcentaje ganancias</MudText>
            <MudText Typo="Typo.h6">12%</MudText>
          </div>
        </MudPaper>
      </MudItem>
      <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="d-flex flex-row pt-6 pb-4" Style="height:100px;">
          <MudIcon Icon="@Icons.Material.Filled.RealEstateAgent" Color="Color.Warning" Class="mx-4" Style="width:40px; height:40px;"></MudIcon>
          <div>
            <MudText Typo="Typo.subtitle1" Class="mud-text-secondary mb-n1">Arrendamientos</MudText>
            <MudText Typo="Typo.h6">4</MudText>
          </div>
        </MudPaper>
      </MudItem>
      <!--Segunda fila-->

      <MudItem xs="12" sm="8">
        <MudPaper Class="pa-4" Style="height:350px;">
          <div>
            <MudChart ChartType="ChartType.Bar" ChartSeries="@Series" @bind-SelectedIndex="Index" XAxisLabels="@XAxisLabels" Width="100%" Height="250px"></MudChart>
          </div>    
          </MudPaper>
      </MudItem>
      <MudItem xs="12" sm="4">
        <MudPaper Class="pa-4" Style="height:350px;">
          <MudChart ChartType="ChartType.Donut" Width="275px" Height="275px" @bind-SelectedIndex="IndexDonut" InputData="@data" InputLabels="@labels"></MudChart>
          </MudPaper>
      </MudItem>
      <!--Tercera fila-->

      <MudItem xs="12" sm="12" md="6">
        <MudCard Style="height:100%;">
          <MudCardHeader>
            <CardHeaderContent>
              <MudText Typo="Typo.h6">Proyectos activos</MudText>
            </CardHeaderContent>
          </MudCardHeader>
          <MudCardContent Class="px-0">
            <MudSimpleTable Elevation="0" Hover="true">
              <thead>
              <tr>
                <th>Nombre</th>
                <th>Prioridad</th>
                <th>Ganancias</th>
              </tr>
              </thead>
              <tbody>
              @foreach (var report in earningReports.OrderBy(x => x.Name))
              {
                <tr>
                  <td>
                    <div class="d-flex flex-row">
                      <MudAvatar>
                        <MudImage Class="mud-elevation-25" Src="@report.Avatar"></MudImage>
                      </MudAvatar>
                      <div class="ml-6">
                        <MudText Typo="Typo.subtitle2">@report.Name</MudText>
                        <MudText Typo="Typo.body2">@report.Title</MudText>
                      </div>
                    </div>
                  </td>
                  <td><MudChip T="string"  Label="true" Color="@report.Severity" Size="Size.Small" Class="ml-auto mud-elevation-25">@report.SeverityTitle</MudChip></td>
                  <td><MudText>@report.Ganancias</MudText></td>
                </tr>
              }
              </tbody>
            </MudSimpleTable>
          </MudCardContent>
        </MudCard>
      </MudItem>
      <MudItem xs="12" sm="12" md="6">
        <MudCard Style="height:100%;">
          <MudCardHeader>
            <CardHeaderContent>
              <MudText Typo="Typo.h6">Accidentes recientes</MudText>
            </CardHeaderContent>
          </MudCardHeader>
          <MudCardContent Class="px-0">
            <MudList T="string" Clickable="true">
              <MudListItem>
                <div class="d-flex flex-row">
                  <MudAvatar Class="mt-4 mud-elevation-25">
                    <MudIcon Icon="@Icons.Material.Filled.BugReport" Class="mx-4" />
                  </MudAvatar>
                  <div class="ml-6">
                    <MudText Typo="Typo.subtitle2">Plaga en cultivos</MudText>
                    <MudText Typo="Typo.body2">Invasión de moscas afectando el 30% de la cosecha</MudText>
                    <MudChip T="string" Label="true" Color="Color.Error" Size="Size.Small" Class="ml-auto mud-elevation-25">Crítico</MudChip>

                  </div>
                </div>
              </MudListItem>

              <MudListItem>
                <div class="d-flex flex-row">
                  <MudAvatar Class="mt-4 mud-elevation-25">
                    <MudIcon Icon="@Icons.Material.Filled.WaterDrop" Class="mx-4" />
                  </MudAvatar>
                  <div class="ml-6">
                    <MudText Typo="Typo.subtitle2">Fallo en sistema de riego</MudText>
                    <MudText Typo="Typo.body2">Baja presión de agua en el sector oeste del campo</MudText>
                    <MudChip T="string" Label="true" Color="Color.Warning" Size="Size.Small" Class="ml-auto mud-elevation-25">Moderado</MudChip>

                  </div>
                </div>
              </MudListItem>

              <MudListItem>
                <div class="d-flex flex-row">
                  <MudAvatar Class="mt-4 mud-elevation-25">
                    <MudIcon Icon="@Icons.Material.Filled.HealthAndSafety" Class="mx-4" />
                  </MudAvatar>
                  <div class="ml-6">
                    <MudText Typo="Typo.subtitle2">Intoxicación por pesticidas</MudText>
                    <MudText Typo="Typo.body2">Dos trabajadores presentaron síntomas tras aplicar químicos</MudText>
                    <MudChip T="string" Label="true" Color="Color.Info" Size="Size.Small" Class="ml-auto mud-elevation-25">Investigación</MudChip>

                  </div>
                </div>
              </MudListItem>
            </MudList>
          </MudCardContent>        </MudCard>
      </MudItem>
      <!--Pie de dashboard para hacer espacio en blanco-->
      <MudItem xs="12" sm="12" md="12">
        <MudPaper Class="d-flex flex-row pt-6 pb-4" Elevation="0" Style="height:5px;">
        </MudPaper>
      </MudItem>
      <br/>
    </MudGrid>
  </Authorized>
</AuthorizeView>


@code{

  private bool isAuthenticated;
  private string userName = "Invitado";
  
  private string Prueba;
  string _value;
  private int IndexDonut = -1; //default value cannot be 0 -> first selectedindex is 0.
  int dataSize = 4;
  public double[] data = { 50, 25, 20, 5 };
  public string[] labels = { "Cebolla", "Arroz", "Aguacate", "Cacao", "Oil", "Coal", "Gas", "Biomass",
    "Hydro", "Geothermal", "Nuclear Fusion", "Pumped Storage", "Solar", "Wind", "Oil",
    "Coal", "Gas", "Biomass", "Hydro", "Geothermal" };
  class EarningReport
  {
    public string Avatar;
    public string Name;
    public string Title;
    public Color Severity;
    public string SeverityTitle;
    public string Ganancias;
  }
  EarningReport[] earningReports = new EarningReport[]
  {
    new EarningReport { Name = "Pedro Sanchez", Title = "Puerto plata", Avatar = "images/avatar/avatar-3.png", Ganancias = "RD$23,200", Severity = Color.Success, SeverityTitle = "Baja"},
    new EarningReport { Name = "Marcos Castillo", Title = "Azua", Avatar = "images/avatar/avatar-4.png", Ganancias = "RD$19,500", Severity = Color.Secondary, SeverityTitle = "Media"},
    new EarningReport { Name = "Juan Martinez", Title = "Bahoruco", Avatar = "images/avatar/avatar-5.png", Ganancias = "RD$4,500", Severity = Color.Primary, SeverityTitle = "Alta"},
  };

  private int Index = -1; //default value cannot be 0 -> first selectedindex is 0.

  public List<ChartSeries> Series = new List<ChartSeries>()
  {
    new ChartSeries() { Name = "Bonao", Data = new double[] { 40, 20, 25, 27, 46, 60, 48, 80, 15 } },
    new ChartSeries() { Name = "Moca", Data = new double[] { 19, 24, 35, 13, 28, 15, 13, 16, 31 } },
    new ChartSeries() { Name = "San Juan", Data = new double[] { 8, 6, 11, 13, 4, 16, 10, 16, 18 } },
  };
  public string[] XAxisLabels = { "Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep" };
}

